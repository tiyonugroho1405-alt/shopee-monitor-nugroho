<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Shopee Monitor Nugroho</title>

<link rel="manifest" href="manifest.json">

<style>

body{
font-family:Arial;
background:#f4f6f8;
padding:15px;
}

.card{
background:white;
padding:12px;
margin-bottom:10px;
border-radius:10px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

input,button{
padding:10px;
margin:5px 0;
width:100%;
border-radius:6px;
border:1px solid #ccc;
}

button{
border:none;
cursor:pointer;
font-weight:bold;
}

.posted{
background:green;
color:white;
}

.delete{
background:#333;
color:white;
}

</style>

</head>
<body>

<h2>Shopee Monitor Nugroho</h2>

<div class="card">

<label>Tanggal</label>
<input type="date" id="tanggal">

<label>Jam</label>
<input type="time" id="jam">

<label>Produk</label>
<input type="text" id="produk" placeholder="Safety Boot">

<button onclick="tambah()">Tambah Jadwal</button>

</div>

<div class="card">
<h3 id="stats"></h3>
</div>

<div id="list"></div>

<script>

let TARGET = 15;

let data = JSON.parse(localStorage.getItem("jadwal") || "[]");

let notified = {};

document.getElementById("tanggal").value =
new Date().toISOString().split('T')[0];


// SAVE
function simpan(){

localStorage.setItem("jadwal", JSON.stringify(data));

render();

}


// ADD
function tambah(){

let tanggal = document.getElementById("tanggal").value;

let jam = document.getElementById("jam").value;

let produk = document.getElementById("produk").value;

if(!tanggal || !jam || !produk){

alert("Lengkapi semua field");

return;

}

data.push({

tanggal,

jam,

produk,

status:"Pending"

});

simpan();

}


// DELETE
function hapus(index){

if(confirm("Hapus jadwal ini?")){

data.splice(index,1);

simpan();

}

}


// UPDATE STATUS
function setPosted(index){

data[index].status="Posted";

simpan();

}


// RENDER
function render(){

let tanggal = document.getElementById("tanggal").value;

// semua jadwal hari ini
let hariIni = data
.filter(d=>d.tanggal===tanggal)
.sort((a,b)=>a.jam.localeCompare(b.jam));

// hitung posted
let posted = hariIni.filter(d=>d.status==="Posted").length;

// tampilkan hanya pending
let tampil = hariIni.filter(d=>d.status==="Pending");

document.getElementById("stats").innerHTML =
`
Tanggal: ${tanggal}<br>
Posted: ${posted} / ${TARGET}<br>
Sisa: ${TARGET-posted}
`;

let html="";

tampil.forEach((d)=>{

let index = data.indexOf(d);

html+=`

<div class="card">

<b>${d.jam} - ${d.produk}</b><br>

Status: Pending<br><br>

<button class="posted" onclick="setPosted(${index})">
Posted
</button>

<button class="delete" onclick="hapus(${index})">
Hapus
</button>

</div>

`;

});

document.getElementById("list").innerHTML = html;

}


// NOTIFICATION PERMISSION
if("Notification" in window){
Notification.requestPermission();
}


// ALARM SYSTEM
function checkAlarm(){

let now = new Date();

let today = now.toISOString().split('T')[0];

let currentTime =
now.getHours().toString().padStart(2,'0') + ":" +
now.getMinutes().toString().padStart(2,'0');

data.forEach(item=>{

if(item.tanggal !== today) return;

if(item.status==="Posted") return;

let alarmTime = item.jam;

let [h,m] = alarmTime.split(":");

let alarmDate = new Date();

alarmDate.setHours(h);
alarmDate.setMinutes(m);
alarmDate.setSeconds(0);


// 5 min before
let before5 = new Date(alarmDate.getTime() - 5*60000);

let before5Str =
before5.getHours().toString().padStart(2,'0') + ":" +
before5.getMinutes().toString().padStart(2,'0');

let key1 = today+"-"+alarmTime+"-5";
let key2 = today+"-"+alarmTime+"-0";


// notify before
if(currentTime === before5Str && !notified[key1]){

showNotification("5 menit lagi posting: "+item.produk);

notified[key1]=true;

}


// notify on time
if(currentTime === alarmTime && !notified[key2]){

showNotification("Wak
